// Generated by CoffeeScript 1.6.2
(function() {
  $(function() {
    var fetch, requestIndex;

    requestIndex = 0;
    $('.datepicker').datepicker({
      dateFormat: 'yy-mm-dd',
      maxDate: new Date()
    });
    if ($('.datepicker').length) {
      $("#from").datepicker("setDate", '-1m');
      $("#to").datepicker("setDate", new Date());
    }
    $('#filter').keyup(function(e) {
      var $results, $this, val, xhr;

      $this = $(this);
      $results = $('section.results');
      val = $this.val().trim();
      if (!val) {
        val = '%';
      }
      $results.addClass('loading');
      if (xhr) {
        xhr.abort;
      }
      return xhr = $.ajax({
        url: "/sites/" + val,
        dataType: "text",
        rqIndex: ++requestIndex,
        success: function(data) {
          $results.removeClass('loading');
          if (this.rqIndex === requestIndex) {
            return $results.html(data);
          }
        },
        error: function() {
          if (this.rqIndex === requestIndex) {
            return $results.html("");
          }
        }
      });
    });
    $(window).bind('popstate', function(event) {
      if (event.originalEvent.state && event.originalEvent.state.page) {
        return fetch(event.originalEvent.state.page, document.location.href, true);
      }
    });
    fetch = function(page, url, popping) {
      return $('#container').load(url, {
        xhr: true
      }, function() {
        window._pystil_init_embed();
        $('nav.xhr a').removeClass('active');
        $('nav.xhr a[data-page=' + page + ']').addClass('active');
        if (!popping) {
          return history && history.pushState && history.pushState({
            page: page
          }, null, url);
        }
      });
    };
    $('nav.xhr a').click(function() {
      var page, url;

      page = $(this).attr('data-page');
      url = $(this).attr('href');
      fetch(page, url);
      return false;
    });
    if ($('nav.xhr a.active').size()) {
      return history && history.pushState && history.pushState({
        page: $('nav.xhr a.active').attr('data-page')
      }, null, document.location.href);
    }
  });

}).call(this);

/*
//@ sourceMappingURL=main.map
*/
