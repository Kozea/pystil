(function(){var a,b,c,d,e,f,g,h,i,j=function(a,b){return function(){return a.apply(b,arguments)}},k=Object.prototype.hasOwnProperty,l=function(a,b){function d(){this.constructor=a}for(var c in b)k.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};b=function(){function a(a){this.elt=a,this.reply=j(this.reply,this),this.elt.addClass("loading"),$.ajax({url:this.url(),method:"GET",dataType:"json",success:this.reply})}return a.prototype.reply=function(a){return this.elt.removeClass("loading")},a}(),f=function(){function a(b){this.elt=b,this.url=j(this.url,this),this.reply=j(this.reply,this),a.__super__.constructor.apply(this,arguments),this.make_tooltip}return l(a,b),a.prototype.reply=function(b){var c,d,e,f,g;a.__super__.reply.apply(this,arguments),f=b.list,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push($("#"+c.key.split("$")[1].toLowerCase()).css({fill:"rgba(0, 0, 255, "+(c.count/b.max*.7+.2)+")"}).prepend($("<title>").text(c.key.split("$")[0].toLowerCase()+": "+c.count)));return g},a.prototype.url=function(){return location.href+"_by_visit.json"},a.prototype.make_tooltip=function(){return $("body").append($("<div>").attr("id","tooltip").css({position:"absolute",display:"none"})),$(".country").mouseover(function(a){return $("#tooltip").css({top:a.pageY+10+"px",left:a.pageX+10+"px",display:"block"}).text($("title",a.currentTarget).text())}),$(".country").mouseout(function(a){return $("#tooltip").css({display:"none"})})},a}(),c=function(){function a(b){this.elt=b,this.plothover=j(this.plothover,this),this.url=j(this.url,this),this.reply=j(this.reply,this),a.__super__.constructor.apply(this,arguments),this.old_index=null,this.elt.bind("plothover",this.plothover)}return l(a,b),a.prototype.reply=function(b){return a.__super__.reply.apply(this,arguments),$.plot(this.elt,this.data(b),this.options)},a.prototype.root=location.pathname+"/",a.prototype.url=function(){return this.root+this.type+"_by_"+this.elt.attr("id")+".json"},a.prototype.plothover=function(a,b,c){var d;if(!c)return $("#tooltip").remove(),this.old_index=null;d=c.series.pie.show?c.seriesIndex:c.dataIndex;if(this.old_index!==d)return this.old_index=d,$("#tooltip").remove(),$("<div>").attr("id","tooltip").css({top:b.pageY+5,left:b.pageX+5,border:"1px solid "+c.series.color}).text(this.tooltip(c)).appendTo("body")},a}(),e=function(){function a(){a.__super__.constructor.apply(this,arguments)}return l(a,c),a.prototype.type="line",a.prototype.options={lines:{show:!0,fill:!0},points:{show:!0,fill:!0},grid:{hoverable:!0},xaxis:{mode:"time",timeformat:"%y-%0m-%0d"},yaxis:{tickDecimals:0}},a.prototype.data=function(a){return a.series},a.prototype.tooltip=function(a){var b,c;return c=a.datapoint[1],b=new Date(a.datapoint[0]),c+" "+a.series.label.toLowerCase()+" on "+b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()},a}(),a=function(){function a(){a.__super__.constructor.apply(this,arguments)}return l(a,c),a.prototype.type="bar",a.prototype.options={bars:{show:!0,fill:!0},grid:{hoverable:!0},xaxis:{min:0,max:23,ticks:24,tickDecimals:0},yaxis:{tickDecimals:0}},a.prototype.data=function(a){return[a]},a.prototype.tooltip=function(a){var b,c;return b=a.datapoint[0],c=a.datapoint[1],c+" visits at "+b+" h"},a}(),h=function(){function b(){b.__super__.constructor.apply(this,arguments)}return l(b,a),b.prototype.options={bars:{show:!0,fill:!0},grid:{hoverable:!0},xaxis:{min:0,max:60,tickDecimals:0},yaxis:{tickDecimals:0}},b.prototype.tooltip=function(a){var b,c;return b=a.datapoint[0],c=a.datapoint[1],c+" visits during between "+b+" and  "+(b+1)+" minutes"},b}(),g=function(){function a(){a.__super__.constructor.apply(this,arguments)}return l(a,c),a.prototype.type="pie",a.prototype.options={grid:{hoverable:!0},series:{pie:{show:!0}}},a.prototype.data=function(a){return a.list},a.prototype.tooltip=function(a){var b;return b=a.datapoint[0],a.series.label+": "+b.toFixed(1)+"%"},a}(),d=function(){function a(b){var c,d,e,f,g,h;this.elt=b,this.update=j(this.update,this),this.ask_update=j(this.ask_update,this),this.reply=j(this.reply,this),this.stamp=0,a.__super__.constructor.apply(this,arguments),this.elt.append(d=$("<table>").append($("<thead>").append(e=$("<tr>")))),h=["Date","Site","Ip","Country","City","Page","Referrer"];for(f=0,g=h.length;f<g;f++)c=h[f],e.append($("<th>").text(c));d.append(this.tbody=$("<tbody>"))}return l(a,b),a.prototype.reply=function(b){return a.__super__.reply.apply(this,arguments),this.update(b)},a.prototype.ask_update=function(){return $.ajax({url:this.url(),method:"GET",dataType:"json",success:this.update})},a.prototype.update=function(a){var b,c,d,e,f,g;if(a.list.length>0)for(b=1,f=a.list.length;1<=f?b<=f:b>=f;1<=f?b++:b--)this.tbody.children().last().remove();g=a.list;for(d=0,e=g.length;d<e;d++)c=g[d],this.tbody.prepend($("<tr>").addClass("new-visit").append($("<td>").text(c.date)).append($("<td>").text(c.host)).append($("<td>").text(c.ip)).append($("<td>").text(c.country)).append($("<td>").text(c.city)).append($("<td>").text(c.page)).append($("<td>").text(c.referrer)));return setTimeout(function(){return $(".new-visit").each(function(a,b){return $(b).removeClass("new-visit")})},1e3),this.stamp=a.stamp,setTimeout(this.ask_update,2500)},a.prototype.url=function(){var a;return location.pathname==="/"?a="/*/":a=location.pathname+"/",this.stamp!==0&&(a+=this.stamp+"/"),a+"last_visits.json"},a}(),i=function(){return $(".graph").each(function(b,c){c=$(c);if(c.hasClass("pie"))return new g(c);if(c.hasClass("line"))return new e(c);if(c.hasClass("bar"))return c.hasClass("time")?new h(c):new a(c)}),$(".map").each(function(a,b){return b=$(b),new f(b)}),$(".last-visits").each(function(a,b){return b=$(b),new d(b)})},$(i)}).call(this)